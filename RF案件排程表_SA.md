# 📘 RF案件排程系統 — 系統分析文件 (SA v2.0)

---

## 📖 文件說明

**版本歷程：**
- v1.0 (2024-01-10)：初版分析文件
- v2.0 (2024-01-20)：調整職責邊界，移除技術實作細節

---

## 1. 專案背景與問題陳述

### 1.1 現況描述

RF測試實驗室目前面臨的挑戰：

**案件特性：**
- 單一案件需測試多種法規（FCC、NCC、CE、IC、TELEC等）
- 每個法規包含多種測試項目（Conducted、Radiated、Blocking等）
- 測試需在不同場地進行（Lab A、Lab B、Lab C等）
- 涉及多位工程師輪班作業（白班、小夜班、大夜班）

**當前管理方式：**
- 使用Excel試算表記錄案件資訊
- 透過Email與口頭溝通協調工作
- 工時記錄在個人筆記或Excel中
- 進度追蹤依賴人工整理

---

### 1.2 核心問題分析

#### 問題1：資訊分散與查詢困難
- **現象：** 案件資料散落在多個Excel檔案與Email中
- **影響：** 難以快速找到特定案件、法規或測項的進度

#### 問題2：工時追蹤不透明
- **現象：** 工程師各自記錄工時，無統一格式
- **影響：** 
  - 主管無法即時掌握實際工時
  - 補測版本(v1/v2/v3)工時混雜，無法比較分析
  - 預估與實際工時差異難以分析

#### 問題3：工程師負載無法視覺化
- **現象：** 主管無法即時看到每位工程師的負載狀況
- **影響：**
  - 任務分配不均，導致部分工程師超載
  - 無法提前預警資源瓶頸
  - 影響案件交期

#### 問題4：延遲原因難以追蹤
- **現象：** 僅知道案件「延遲」，但不清楚根本原因
- **影響：**
  - 無法針對性改善流程
  - 無法釐清責任歸屬（設備、客戶、人力、場地）
  - 重複發生相同問題

#### 問題5：缺乏權限控管與稽核
- **現象：** 
  - 任何人都可修改Excel，無記錄誰改了什麼
  - 資料被誤刪或覆蓋時無法追查
- **影響：** 資料可信度降低，發生爭議時無憑據

#### 問題6：多人協作版本衝突
- **現象：** 兩人同時編輯同一Excel，後存檔者覆蓋前者
- **影響：** 資料遺失，需重新輸入

---

## 2. 專案目標與成功指標

### 2.1 專案願景

> 建立一套集中化、可追蹤、可分析的RF案件排程與工時管理系統，讓工程師專注測試工作，讓主管即時掌握專案進度與資源負載。

---

### 2.2 專案目標

#### 目標1：集中化資料管理
- **描述：** 所有案件、法規、測項、工時資料集中儲存於單一系統
- **衡量指標：** 
  - 90%以上的資料查詢可在系統內完成
  - 不再需要Excel進行案件管理

#### 目標2：標準化流程
- **描述：** 透過Wizard流程標準化建案步驟

#### 目標3：即時工時追蹤
- **描述：** 工程師每日回報工時，系統即時累計與統計
- **衡量指標：** 
  - 工時回報即時性達100%（當日回報）

#### 目標4：視覺化資源負載
- **描述：** 主管可即時查看每位工程師的負載狀況

#### 目標5：延遲根因分析
- **描述：** 系統記錄延遲原因，支援統計分析
- **衡量指標：** 
  - 100%延遲案件有明確原因記錄
  - 每季產出延遲原因分析報告

#### 目標6：完整稽核機制
- **描述：** 所有資料異動皆可追蹤
- **衡量指標：** 

---

## 3. 利害關係人分析

### 3.1 主要利害關係人

#### 3.1.1 工程師 (Engineer)
- **人數：** 約20人
- **需求：**
  - 快速查看自己負責的測項
  - 簡便的工時回報介面
  - 了解自己的工作進度
- **痛點：**
  - 現有Excel難以快速找到自己的任務
  - 工時記錄繁瑣易遺漏
  - 不清楚自己的Loading狀況
- **期望：**
  - 工時回報時間<2分鐘/次
  - 可隨時查看歷史工時記錄
  - 介面直覺易用

---

#### 3.1.2 實驗室主管 (Manager)
- **人數：** 3-5人
- **需求：**
  - 快速建立新案件
  - 即時掌握所有案件進度
  - 視覺化工程師負載
  - 分析延遲原因
  - 產出各類管理報表
- **痛點：**
  - Excel建案繁瑣易錯
  - 無法即時看到資源瓶頸
  - 手動彙整報表耗時
  - 延遲原因難以追蹤
- **期望：**
  - Wizard引導式建案
  - Dashboard一目了然
  - 一鍵產出報表
  - 完整稽核追蹤

---

## 4. 系統範圍定義

### 4.1 系統邊界

#### 4.1.1 納入範圍 (In Scope)

**核心功能：**
1. ✅ 案件管理（建立、查詢、修改、刪除）
2. ✅ 法規管理（多法規支援）
3. ✅ 測試項目管理（測項定義、工程師分配）
4. ✅ 工時回報（工程師端）
5. ✅ 工時查詢與統計（主管端）
6. ✅ Loading計算與視覺化
7. ✅ 延遲原因管理與分析
8. ✅ 補測版本管理（v1/v2/v3...）
9. ✅ 稽核日誌（資料異動追蹤）
10. ✅ 權限控管（工程師/主管）
11. ✅ 忘記密碼功能（Email重設）
12. ✅ 報表產出（進度、工時、延遲分析）

**資料管理：**
- ✅ 使用者管理
- ✅ 角色管理（Engineer/Manager）
- ✅ 延遲原因字典維護
- ✅ Soft Delete機制

---
### 4.1 系統與外部系統互動

```
┌─────────────────────────────────────┐
│   RF案件排程系統 (本系統)             │
│                                     │
│  ┌──────┐  ┌──────┐  ┌──────┐       │
│  │案件  │  │工時  │  │Loading│       │
│  │管理  │  │管理  │  │分析  │        │
│  └──────┘  └──────┘  └──────┘       │ 
│                                     │
└─────────────────────────────────────┘
         ↓ (Email)
┌─────────────────┐
│  Email Server   │ (發送密碼重設信、新帳號通知)
└─────────────────┘
```

**說明：**
- 系統僅與Email Server互動（發送系統通知信）
- 資料匯出格式：Excel（供人工匯入其他系統）

---

## 5. 功能需求總覽

### 5.1 功能模組架構

```
RF案件排程系統
│
├─ 1. 認證與授權模組
│   ├─ 1.1 使用者登入
│   ├─ 1.2 忘記密碼（Email重設）
│   ├─ 1.3 角色權限控管（RBAC）
│   └─ 1.4 登入安全機制（失敗次數限制）
│
├─ 2. 案件管理模組
│   ├─ 2.1 Wizard建案流程
│   │   ├─ Step 1: 案件基本資料
│   │   ├─ Step 2: 選擇法規
│   │   ├─ Step 3: 新增測試項目
│   │   └─ Step 4: 分配工程師
│   ├─ 2.2 案件查詢與瀏覽
│   ├─ 2.3 案件修改（含理由記錄）
│   ├─ 2.4 案件刪除（Soft Delete）
│   └─ 2.5 案件狀態自動計算
│
├─ 3. 測試項目管理模組
│   ├─ 3.1 測項新增與修改
│   ├─ 3.2 工程師分配（Main/Sub）
│   ├─ 3.3 補測版本管理（Revision）
│   ├─ 3.4 測項狀態追蹤
│   └─ 3.5 測項刪除（Soft Delete）
│
├─ 4. 工時管理模組
│   ├─ 4.1 工時回報（工程師端）
│   │   ├─ 選擇測項與版本
│   │   ├─ 輸入日期與工時
│   │   ├─ 設定狀態（進行中/完成/延遲）
│   │   └─ 選擇延遲原因（若延遲）
│   ├─ 4.2 工時查詢（工程師可查自己）
│   ├─ 4.3 工時修改（7天內可改）
│   ├─ 4.4 工時統計（主管端）
│   └─ 4.5 工時覆寫（主管含理由）
│
├─ 5. Loading分析模組
│   ├─ 5.1 工程師Loading總覽
│   │   ├─ 計算Assigned Loading
│   │   ├─ 計算Actual Loading
│   │   └─ 超載警示（顏色標示）
│   ├─ 5.2 工程師Loading明細
│   │   ├─ 測項清單
│   │   ├─ 工時統計
│   │   └─ 趨勢圖表
│   └─ 5.3 Loading報表匯出
│
├─ 6. 延遲管理模組
│   ├─ 6.1 延遲原因字典維護
│   │   ├─ 新增/修改延遲原因
│   │   ├─ 停用/啟用（已使用不可刪除）
│   │   └─ 延遲原因分類（設備/客戶/工程師/場地）
│   ├─ 6.2 延遲案件追蹤
│   └─ 6.3 延遲原因分析報表
│
├─ 7. 使用者管理模組
│   ├─ 7.1 使用者新增
│   │   ├─ 自動產生初始密碼
│   │   └─ 發送Email通知
│   ├─ 7.2 使用者修改
│   ├─ 7.3 使用者停用/啟用
│   │   └─ 停用前檢查負責測項
│   └─ 7.4 使用者查詢
│
├─ 8. 稽核日誌模組
│   ├─ 8.1 自動記錄資料異動
│   │   ├─ 記錄誰（Who）
│   │   ├─ 改了什麼（What）
│   │   ├─ 何時改（When）
│   │   └─ 為何改（Why - 理由欄位）
│   ├─ 8.2 稽核日誌查詢
│   │   ├─ 依資料表篩選
│   │   ├─ 依操作類型篩選
│   │   ├─ 依操作人篩選
│   │   └─ 依時間區間篩選
│   └─ 8.3 稽核日誌詳細檢視
│       └─ Before/After比對
│
├─ 9. 報表模組
│   ├─ 9.1 案件進度報表
│   │   ├─ 案件概要
│   │   ├─ 法規完成度
│   │   ├─ 測項進度明細
│   │   └─ 工時統計
│   ├─ 9.2 工時統計報表
│   │   ├─ 依案件統計
│   │   ├─ 依工程師統計
│   │   └─ 依期間統計
│   ├─ 9.3 延遲分析報表
│   │   ├─ 延遲原因分布
│   │   ├─ 延遲測項清單
│   │   └─ 延遲趨勢分析
│   └─ 9.4 報表匯出（Excel）
│
└─ 10. 系統設定模組
    ├─ 10.1 一般參數設定
    │   ├─ 預設每週工時
    │   ├─ WorkLog可修改天數
    │   └─ 登入失敗鎖定設定
    ├─ 10.2 Email設定
    │   ├─ SMTP伺服器設定
    │   └─ Email範本設定
    └─ 10.3 資料保留政策
        ├─ AuditLog保留天數
        └─ 已刪除資料保留天數
```

---

### 5.2 使用案例圖 (Use Case Diagram)

```
┌─────────────────────────────────────────────┐
│           RF案件排程系統                      │
│                                             │
│  ┌──────────────────────────────────────┐  │
│  │  認證與授權                           │  │
│  │  • 登入                               │  │
│  │  • 忘記密碼                           │  │
│  └──────────────────────────────────────┘  │
│                                             │
│  ┌──────────────────────────────────────┐  │
│  │  工程師功能                           │  │
│  │  • 查看我的測項                       │  │
│  │  • 回報工時                           │  │
│  │  • 查詢工時記錄                       │  │
│  │  • 修改工時(7天內)                    │  │
│  └──────────────────────────────────────┘  │
│             ↑                               │
│         Engineer                            │
│                                             │
│  ┌──────────────────────────────────────┐  │
│  │  主管功能                             │  │
│  │  • Wizard建案                         │  │
│  │  • 管理案件                           │  │
│  │  • 管理測項                           │  │
│  │  • 分配工程師                         │  │
│  │  • 建立補測版本                       │  │
│  │  • 查看Loading報表                    │  │
│  │  • 查看延遲分析                       │  │
│  │  • 管理使用者                         │  │
│  │  • 管理延遲原因                       │  │
│  │  • 查詢稽核日誌                       │  │
│  │  • 產出各類報表                       │  │
│  │  • 覆寫工時(含理由)                   │  │
│  └──────────────────────────────────────┘  │
│             ↑                               │
│          Manager                            │
│                                             │
└─────────────────────────────────────────────┘
```

---

## 6. 功能需求詳述

### 6.1 認證與授權需求

#### FR-AUTH-001：使用者登入
- **優先級：** 必須 (Must Have)
- **描述：** 使用者需以帳號與密碼登入系統
- **驗收標準：**
  - 輸入正確帳密可成功登入
  - 輸入錯誤帳密顯示「帳號或密碼錯誤」
  - 停用帳號無法登入
  - 連續失敗5次鎖定10分鐘

#### FR-AUTH-002：密碼安全儲存
- **優先級：** 必須 (Must Have)
- **描述：** 密碼需以不可逆方式儲存
- **驗收標準：**
  - 資料庫儲存Hash值
  - 系統無任何功能可查看原密碼
  - Hash演算法使用業界標準（如bcrypt）

#### FR-AUTH-003：忘記密碼功能
- **優先級：** 必須 (Must Have)
- **描述：** 使用者可透過Email重設密碼
- **驗收標準：**
  - 可用帳號或Email申請重設
  - 系統發送重設連結至註冊Email
  - 連結30分鐘內有效
  - 連結僅能使用一次
  - 不顯示帳號是否存在（安全性）

#### FR-AUTH-004：角色權限控管
- **優先級：** 必須 (Must Have)
- **描述：** 系統需區分Engineer與Manager角色
- **驗收標準：**
  - Engineer僅能存取自己的功能
  - Manager可存取所有功能
  - 無權限時顯示明確錯誤訊息

---

### 6.2 案件管理需求

#### FR-PROJ-001：Wizard建案流程
- **優先級：** 必須 (Must Have)
- **描述：** 提供4步驟引導式建案流程
- **驗收標準：**
  - Step 1完成才能進Step 2
  - 可隨時返回前一步修改
  - Step 4完成顯示確認摘要
  - 確認後一次性寫入所有資料

#### FR-PROJ-002：案件基本資料管理
- **優先級：** 必須 (Must Have)
- **描述：** 可新增、查詢、修改、刪除案件
- **驗收標準：**
  - 案件名稱不可重複
  - 日期邏輯正確（結束≥開始）
  - 修改需填寫理由
  - 刪除採Soft Delete

#### FR-PROJ-003：案件狀態自動計算
- **優先級：** 必須 (Must Have)
- **描述：** 案件狀態依測項狀態自動更新
- **驗收標準：**
  - 任一測項延遲→案件延遲
  - 所有測項完成→案件完成
  - 有測項進行中→案件進行中
  - 主管可手動設為OnHold

---

### 6.3 測試項目管理需求

#### FR-TEST-001：測項新增與修改
- **優先級：** 必須 (Must Have)
- **描述：** 可在法規下新增測項
- **驗收標準：**
  - 預估工時需>0
  - 需指定測試類型與場地

#### FR-TEST-002：工程師分配
- **優先級：** 必須 (Must Have)
- **描述：** 可將測項分配給工程師
- **驗收標準：**
  - 至少需1位主要(Main)工程師
  - 可分配多位支援(Sub)工程師
  - 分配工時總和與預估工時差異>20%需警告
  - 顯示工程師當前Loading

#### FR-TEST-003：補測版本管理
- **優先級：** 必須 (Must Have)
- **描述：** 可建立測項的補測版本
- **驗收標準：**
  - 版本編號不可重複（v2/v3/v4...）
  - 可選擇複製原工程師分配
  - 建立補測後測項狀態改為InProgress
  - 需填寫補測原因

---

### 6.4 工時管理需求

#### FR-WORK-001：工時回報
- **優先級：** 必須 (Must Have)
- **描述：** 工程師可回報每日工時
- **驗收標準：**
  - 工作日期不可晚於今天
  - 單日工時0.5-12小時
  - 同測項同日期不可重複回報
  - 狀態=延遲時必須選延遲原因

#### FR-WORK-002：工時修改限制
- **優先級：** 必須 (Must Have)
- **描述：** 工程師可修改7天內的工時
- **驗收標準：**
  - 7天內可修改
  - 超過7天顯示錯誤訊息
  - 修改後寫入AuditLog

#### FR-WORK-003：工時狀態同步
- **優先級：** 必須 (Must Have)
- **描述：** 工時回報後自動更新測項狀態
- **驗收標準：**
  - 首次回報→測項InProgress
  - 任一工程師回報延遲→測項Delayed
  - 所有工程師完成→測項Completed

#### FR-WORK-004：工時查詢
- **優先級：** 必須 (Must Have)
- **描述：** 工程師可查詢自己的工時記錄
- **驗收標準：**
  - 可依測項篩選
  - 可依日期區間篩選
  - 可依版本篩選
  - 顯示統計資訊（總工時、剩餘工時）

#### FR-WORK-005：主管覆寫工時
- **優先級：** 應該 (Should Have)
- **描述：** 主管可修改任何工時記錄
- **驗收標準：**
  - 需填寫修改理由
  - 理由寫入AuditLog
  - 原值與新值皆記錄

---

### 6.5 Loading分析需求

#### FR-LOAD-001：Loading計算
- **優先級：** 必須 (Must Have)
- **描述：** 系統自動計算工程師Loading
- **驗收標準：**
  - Assigned Loading = Σ(分配工時) / 可用工時 × 100%
  - Actual Loading = Σ(實際工時) / 可用工時 × 100%
  - 僅計算Active狀態案件

#### FR-LOAD-002：Loading視覺化
- **優先級：** 必須 (Must Have)
- **描述：** 以顏色標示Loading狀態
- **驗收標準：**
  - ≤60%：綠色
  - 61-80%：黃色
  - 81-100%：橘色
  - >100%：紅色（超載）

#### FR-LOAD-003：Loading明細
- **優先級：** 必須 (Must Have)
- **描述：** 可查看工程師Loading明細
- **驗收標準：**
  - 顯示負責的所有測項
  - 顯示各測項分配/實際/剩餘工時
  - 提供工時趨勢圖表

#### FR-LOAD-004：超載預警
- **優先級：** 應該 (Should Have)
- **描述：** 分配工作時若導致超載需警告
- **驗收標準：**
  - 分配時即時計算新Loading
  - >100%顯示警告對話框
  - 允許繼續或取消

---

### 6.6 延遲管理需求

#### FR-DELAY-001：延遲原因字典
- **優先級：** 必須 (Must Have)
- **描述：** 主管可維護延遲原因清單
- **驗收標準：**
  - 可新增延遲原因（含類型：設備/客戶/工程師/場地）
  - 可修改延遲原因文字
  - 可停用/啟用
  - 已使用的不可刪除（僅能停用）

#### FR-DELAY-002：延遲原因記錄
- **優先級：** 必須 (Must Have)
- **描述：** 工時狀態=延遲時需選原因
- **驗收標準：**
  - 可多選延遲原因
  - 至少需選1個
  - 未選擇無法送出

#### FR-DELAY-003：延遲分析報表
- **優先級：** 應該 (Should Have)
- **描述：** 提供延遲原因統計分析
- **驗收標準：**
  - 顯示延遲原因分布（圓餅圖）
  - 顯示延遲測項清單
  - 可依期間/案件篩選
  - 可匯出Excel

---

### 6.7 使用者管理需求

#### FR-USER-001：使用者新增
- **優先級：** 必須 (Must Have)
- **描述：** 主管可新增使用者
- **驗收標準：**
  - 帳號唯一不可重複
  - Email唯一不可重複
  - 系統自動產生初始密碼
  - 自動發送Email通知新使用者

#### FR-USER-002：使用者停用
- **優先級：** 必須 (Must Have)
- **描述：** 主管可停用使用者
- **驗收標準：**
  - 停用前檢查是否負責未完成測項
  - 若有負責測項顯示警告
  - 停用後無法登入
  - 歷史資料保留

#### FR-USER-003：使用者資料修改
- **優先級：** 必須 (Must Have)
- **描述：** 主管可修改使用者資料
- **驗收標準：**
  - 可修改顯示名稱、Email、角色
  - 帳號不可修改
  - 每週可用工時可調整

---

### 6.8 稽核日誌需求

#### FR-AUDIT-001：自動記錄異動
- **優先級：** 必須 (Must Have)
- **描述：** 系統自動記錄重要資料異動
- **驗收標準：**
  - 記錄資料表名稱
  - 記錄記錄ID
  - 記錄操作類型（Create/Update/Delete）
  - 記錄操作人
  - 記錄操作時間
  - 記錄變更前後值（JSON格式）

#### FR-AUDIT-002：稽核日誌查詢
- **優先級：** 必須 (Must Have)
- **描述：** 主管可查詢稽核日誌
- **驗收標準：**
  - 可依資料表篩選
  - 可依操作類型篩選
  - 可依操作人篩選
  - 可依時間區間篩選
  - 可匯出Excel

#### FR-AUDIT-003：變更比對檢視
- **優先級：** 應該 (Should Have)
- **描述：** 可檢視資料變更前後差異
- **驗收標準：**
  - 雙欄顯示Before/After
  - 變更欄位以顏色標示
  - 支援JSON格式解析

---

### 6.9 報表需求

#### FR-REPORT-001：案件進度報表
- **優先級：** 必須 (Must Have)
- **描述：** 顯示案件整體進度
- **驗收標準：**
  - 顯示案件基本資訊
  - 顯示法規完成度（長條圖）
  - 顯示測項進度明細
  - 顯示工時統計（預估vs實際）
  - 支援excel匯出

#### FR-REPORT-002：工時統計報表
- **優先級：** 必須 (Must Have)
- **描述：** 提供多維度工時統計
- **驗收標準：**
  - 可依案件統計
  - 可依工程師統計
  - 可依期間統計
  - 提供圖表視覺化
  - 支援Excel匯出

#### FR-REPORT-003：延遲分析報表
- **優先級：** 應該 (Should Have)
- **描述：** 分析延遲原因與趨勢
- **驗收標準：**
  - 延遲原因分布圓餅圖
  - 延遲測項清單
  - 平均延遲天數統計
  - 可依期間篩選

---

## 7. 非功能需求

### 7.1 效能需求 (Performance)

#### NFR-PERF-001：回應時間
- **需求：** 一般查詢操作回應時間<2秒
- **測試條件：** 50筆資料以內
- **優先級：** 必須 (Must Have)

#### NFR-PERF-002：工時查詢效能
- **需求：** 單一案件工時查詢<3秒
- **測試條件：** 500筆WorkLog記錄
- **優先級：** 必須 (Must Have)

#### NFR-PERF-003：Loading計算效能
- **需求：** Loading計算<2秒
- **測試條件：** 15位工程師、30個Active案件
- **優先級：** 必須 (Must Have)

#### NFR-PERF-004：報表產出效能
- **需求：** 報表產出<5秒
- **測試條件：** 單一案件、100個測項
- **優先級：** 應該 (Should Have)

---

### 7.2 安全需求 (Security)

#### NFR-SEC-001：密碼安全
- **需求：** 密碼採Hash不可逆儲存
- **標準：** 使用bcrypt或類似演算法
- **優先級：** 必須 (Must Have)

#### NFR-SEC-002：身份驗證
- **需求：** 所有API需驗證身份
- **標準：** 使用JWT Token機制
- **優先級：** 必須 (Must Have)

#### NFR-SEC-003：權限控管
- **需求：** 依角色控管功能存取
- **標準：** Engineer不能存取Manager功能
- **優先級：** 必須 (Must Have)

#### NFR-SEC-004：資料隔離
- **需求：** 工程師只能看自己的資料
- **標準：** 查詢需加入UserId過濾
- **優先級：** 必須 (Must Have)

#### NFR-SEC-005：密碼複雜度
- **需求：** 密碼需符合複雜度規則
- **標準：** 8-20字元、含英文數字
- **優先級：** 必須 (Must Have)

#### NFR-SEC-006：登入失敗鎖定
- **需求：** 連續失敗5次鎖定10分鐘
- **標準：** IP或帳號層級鎖定
- **優先級：** 應該 (Should Have)

---

### 7.3 可用性需求 (Usability)

#### NFR-USAB-001：學習曲線
- **需求：** 新使用者30分鐘內可完成基本操作
- **衡量：** 使用者測試達成率>80%
- **優先級：** 應該 (Should Have)

#### NFR-USAB-002：錯誤訊息
- **需求：** 錯誤訊息清楚明確
- **標準：** 告知原因與解決方式
- **優先級：** 必須 (Must Have)

#### NFR-USAB-003：操作直覺性
- **需求：** 不需查閱手冊可完成90%操作
- **衡量：** 使用者測試回饋
- **優先級：** 應該 (Should Have)

#### NFR-USAB-004：回饋及時性
- **需求：** 操作後立即顯示結果
- **標準：** 載入中顯示進度指示
- **優先級：** 必須 (Must Have)

---

### 7.4 可靠性需求 (Reliability)

#### NFR-RELI-001：可用性
- **需求：** 系統可用性>99%
- **測試條件：** 每月統計
- **優先級：** 應該 (Should Have)

#### NFR-RELI-002：資料完整性
- **需求：** 資料異動需Transaction保護
- **標準：** 關鍵操作全成功或全失敗
- **優先級：** 必須 (Must Have)

#### NFR-RELI-003：資料備份
- **需求：** 每日自動備份
- **標準：** 保留30天備份
- **優先級：** 必須 (Must Have)

#### NFR-RELI-004：錯誤處理
- **需求：** 系統錯誤不導致資料遺失
- **標準：** 異常回滾、記錄日誌
- **優先級：** 必須 (Must Have)

---

### 7.5 可維護性需求 (Maintainability)

#### NFR-MAIN-001：日誌記錄
- **需求：** 記錄系統運作日誌
- **標準：** 包含錯誤、警告、資訊層級
- **優先級：** 必須 (Must Have)

#### NFR-MAIN-002：版本控制
- **需求：** 程式碼使用版本控管
- **標準：** Git或類似工具
- **優先級：** 必須 (Must Have)

---

### 7.6 擴充性需求 (Scalability)

#### NFR-SCAL-001：使用者數量
- **需求：** 支援至少20名同時使用者
- **測試條件：** 並發操作測試
- **優先級：** 必須 (Must Have)

#### NFR-SCAL-002：資料量
- **需求：** 支援至少500個Active案件
- **測試條件：** 效能不明顯下降
- **優先級：** 應該 (Should Have)

#### NFR-SCAL-003：功能擴充性
- **需求：** 架構支援未來功能擴充
- **標準：** 模組化設計
- **優先級：** 應該 (Should Have)

---

### 7.7 相容性需求 (Compatibility)

#### NFR-COMP-001：作業系統
- **需求：** 支援Windows 10/11
- **優先級：** 必須 (Must Have)

#### NFR-COMP-002：資料庫
- **需求：** 使用SQL Server 2019以上
- **優先級：** 必須 (Must Have)

#### NFR-COMP-003：.NET版本
- **需求：** 使用.NET 8
- **優先級：** 必須 (Must Have)

---

## 8. 業務規則

### 8.1 時間相關規則

#### BR-TIME-001：案件日期邏輯
- **規則：** Project.EndDate必須≥Project.StartDate
- **違反處理：** 前端阻擋送出，顯示錯誤訊息
- **例外：** 無

#### BR-TIME-002：法規日期範圍
- **規則：** Regulation日期需在Project日期±30天內
- **違反處理：** 顯示警告，允許繼續但需確認
- **例外：** 特殊案件經主管核准

#### BR-TIME-003：工時回報日期
- **規則：** WorkLog.WorkDate不可晚於今天
- **違反處理：** 前端阻擋送出
- **例外：** 無

#### BR-TIME-004：工時修改期限
- **規則：** 工程師只能修改7天內的WorkLog
- **違反處理：** 顯示錯誤，建議聯繫主管
- **例外：** 主管可修改任何時間的WorkLog

---

### 8.2 工時相關規則

#### BR-HOUR-001：預估工時下限
- **規則：** TestItem.EstimatedHours必須>0
- **違反處理：** 前端阻擋送出
- **例外：** 無

#### BR-HOUR-002：單日工時上限
- **規則：** 單日WorkLog.ActualHours≤12
- **違反處理：** 顯示警告，允許繼續但需確認
- **例外：** 緊急趕工案件

#### BR-HOUR-003：分配工時合理性
- **規則：** Σ(AssignedHours)與EstimatedHours差異不宜>20%
- **違反處理：** 顯示警告，允許繼續
- **例外：** 複雜案件難以精確預估

#### BR-HOUR-004：累計工時警示
- **規則：** 實際工時累計超過分配工時150%需警示
- **違反處理：** 顯示警告，允許繼續
- **例外：** 案件複雜度超出預期

---

### 8.3 分配相關規則

#### BR-ASSIGN-001：主要工程師必要性
- **規則：** 每個TestItem至少需1位Main工程師
- **違反處理：** 前端阻擋送出
- **例外：** 無

#### BR-ASSIGN-002：工程師唯一性
- **規則：** 同一TestItem不可重複分配同一工程師
- **違反處理：** 前端阻擋送出
- **例外：** 無

#### BR-ASSIGN-003：Loading合理性
- **規則：** 分配工作時顯示工程師當前Loading
- **違反處理：** >100%顯示警告，允許繼續
- **例外：** 緊急案件或短期超載可接受

---

### 8.4 延遲相關規則

#### BR-DELAY-001：延遲原因必填
- **規則：** WorkLog.Status=Delayed時必須選延遲原因
- **違反處理：** 前端阻擋送出
- **例外：** 無

#### BR-DELAY-002：延遲原因多選
- **規則：** 可選擇多個延遲原因
- **說明：** 延遲可能由多種因素造成
- **例外：** 無

#### BR-DELAY-003：延遲原因刪除限制
- **規則：** 已被使用的DelayReason不可刪除
- **違反處理：** 顯示錯誤，建議改為停用
- **例外：** 無

---

### 8.5 刪除相關規則

#### BR-DELETE-001：軟刪除原則
- **規則：** Project/Regulation/TestItem/TestItemEngineer採Soft Delete
- **說明：** 設定IsDeleted=true，資料實際保留
- **例外：** WorkLog一律不刪除

#### BR-DELETE-002：連動刪除
- **規則：** 刪除Project時連動刪除下層Regulation與TestItem
- **說明：** 採Soft Delete，資料皆保留
- **例外：** 無

#### BR-DELETE-003：工時記錄保留
- **規則：** WorkLog不因上層刪除而刪除
- **說明：** 用於稽核與歷史查詢
- **例外：** 無

#### BR-DELETE-004：停用工程師處理
- **規則：** 停用工程師前需檢查負責的未完成測項
- **違反處理：** 顯示警告，列出受影響測項
- **例外：** 可強制停用，但測項需重新分配

---

### 8.6 狀態轉換規則

#### BR-STATUS-001：測項狀態自動更新
- **規則：** TestItem.Status依WorkLog自動計算
- **邏輯：**
  - 任一WorkLog=Delayed → TestItem=Delayed
  - 所有工程師最後WorkLog=Completed → TestItem=Completed
  - 否則 → TestItem=InProgress
- **例外：** 主管可手動設為OnHold

#### BR-STATUS-002：案件狀態自動更新
- **規則：** Project.Status依TestItem自動計算
- **邏輯：**
  - 任一TestItem=Delayed → Project=Delayed
  - 所有TestItem=Completed → Project=Completed
  - 有TestItem=InProgress → Project=Active
- **例外：** 主管可手動設為OnHold

#### BR-STATUS-003：補測版本狀態重設
- **規則：** 建立TestItemRevision後，TestItem.Status改為InProgress
- **說明：** 表示需要重新測試
- **例外：** 無

---

## 9. 資料需求概述

### 9.1 主要資料實體

#### 9.1.1 User (使用者)
- **說明：** 系統使用者，包含工程師與主管
- **關鍵屬性：**
  - 帳號（唯一）
  - 密碼Hash
  - 顯示名稱
  - Email（唯一）
  - 角色（Engineer/Manager）
  - 每週可用工時
  - 是否啟用
- **關聯：**
  - 一位User可負責多個TestItem
  - 一位User可有多筆WorkLog

#### 9.1.2 Project (案件)
- **說明：** RF測試案件
- **關鍵屬性：**
  - 案件名稱（唯一）
  - 客戶名稱
  - 優先順序（High/Medium/Low）
  - 狀態（Draft/Active/Completed/OnHold/Delayed）
  - 預計開始日期
  - 預計結束日期
- **關聯：**
  - 一個Project有多個Regulation

#### 9.1.3 Regulation (法規)
- **說明：** 案件需測試的法規
- **關鍵屬性：**
  - 法規名稱（FCC/NCC/CE/IC/TELEC等）
  - 開始日期
  - 結束日期
- **關聯：**
  - 隸屬於一個Project
  - 一個Regulation有多個TestItem

#### 9.1.4 TestItem (測試項目)
- **說明：** 具體的測試項目
- **關鍵屬性：**
  - 測項名稱
  - 測試類型（Conducted/Radiated等）
  - 測試場地
  - 預估工時
  - 狀態（NotStarted/InProgress/Completed/Delayed/OnHold）
- **關聯：**
  - 隸屬於一個Regulation
  - 可分配給多位工程師
  - 可有多筆WorkLog
  - 可有多個補測版本

#### 9.1.5 TestItemEngineer (工程師分配)
- **說明：** 測項與工程師的關聯
- **關鍵屬性：**
  - 角色類型（Main/Sub）
  - 分配工時
- **關聯：**
  - 連結TestItem與User

#### 9.1.6 WorkLog (工時記錄)
- **說明：** 工程師的每日工時記錄
- **關鍵屬性：**
  - 工作日期
  - 實際工時
  - 狀態（InProgress/Completed/Delayed）
  - 備註
- **關聯：**
  - 隸屬於一個TestItem
  - 隸屬於一個User
  - 可對應一個TestItemRevision
  - 可關聯多個DelayReason

#### 9.1.7 TestItemRevision (補測版本)
- **說明：** 測項的補測版本記錄
- **關鍵屬性：**
  - 版本編號（v2/v3/v4...）
  - 建立原因
  - 預估工時
- **關聯：**
  - 隸屬於一個TestItem

#### 9.1.8 DelayReason (延遲原因)
- **說明：** 延遲原因字典
- **關鍵屬性：**
  - 原因文字
  - 原因類型（Equipment/Customer/Engineer/Location）
  - 是否啟用
- **關聯：**
  - 可被多個WorkLog參考

#### 9.1.9 AuditLog (稽核日誌)
- **說明：** 資料異動稽核記錄
- **關鍵屬性：**
  - 資料表名稱
  - 記錄ID
  - 操作類型（Create/Update/Delete）
  - 變更前值（JSON）
  - 變更後值（JSON）
  - 操作人
  - 操作時間
  - 修改理由

---

### 9.2 資料關聯概念圖

```
User (使用者)
  ├─ 建立/修改 → Project (案件)
  ├─ 負責 → TestItem (測項) [透過TestItemEngineer]
  └─ 回報 → WorkLog (工時記錄)

Project (案件)
  └─ 包含 → Regulation (法規)
      └─ 包含 → TestItem (測項)
          ├─ 分配給 → User (工程師) [透過TestItemEngineer]
          ├─ 記錄 → WorkLog (工時記錄)
          └─ 建立 → TestItemRevision (補測版本)

WorkLog (工時記錄)
  └─ 選擇 → DelayReason (延遲原因) [透過WorkLogDelayReason]

AuditLog (稽核日誌)
  └─ 記錄所有實體的異動
```

---

